<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Admin)</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f4f8;
    margin: 0;
    padding: 20px;
  }
  .edit-container {
    max-width: 900px;
    margin: 50px auto;
    background: #fff;
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  }
  h2 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
  }
  button.back-button {
    background-color: #1976D2;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 10px;
    font-size: 1rem;
    cursor: pointer;
    margin-bottom: 20px;
    transition: background-color 0.3s ease;
  }
  button.back-button:hover {
    background-color: #0d47a1;
  }
  form {
    margin-bottom: 30px;
  }
  label {
    font-weight: bold;
    display: block;
    margin: 15px 0 5px;
  }
  input[type="text"], input[type="email"], input[type="password"] {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    border-radius: 10px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  button.saveBtn {
    padding: 10px 20px;
    font-size: 1rem;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background-color: #4CAF50;
    color: white;
    transition: background-color 0.3s ease;
  }
  button.saveBtn:hover {
    background-color: #388e3c;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    table-layout: fixed;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 12px;
    text-align: left;
    word-wrap: break-word;
    vertical-align: middle;
  }
  td input {
    width: 100%;
    padding: 8px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #aaa;
    box-sizing: border-box;
  }
  .error, .success {
    text-align: center;
    margin-top: 15px;
    font-size: 1rem;
  }
  .error { color: red; }
  .success { color: green; }

  /* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π/‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô */
  .togglePwdBtn {
    margin-top: 8px;
    padding: 6px 10px;
    font-size: 0.9rem;
    background-color: #2196F3;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
  }
  .togglePwdBtn:hover {
    background-color: #1976D2;
  }

  /* Modal for admin login */
  #adminLoginModal {
    position: fixed;
    top: 0;
    left: 0;
    right:0;
    bottom:0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #adminLoginModal .modal-content {
    background: white;
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    width: 320px;
  }
  #adminLoginModal h3 {
    margin-top: 0;
    text-align: center;
  }
  #adminLoginModal input[type="password"] {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    border-radius: 10px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  #adminLoginModal button {
    width: 100%;
    margin-top: 20px;
    background-color: #2196F3;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    
    padding: 8px 0;       /* ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
    font-size: 1.2rem;     /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
  }
  #adminLoginModal button:hover {
    background-color: #1976D2;
  }
</style>
</head>
<body>

<!-- Modal login ‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô -->
<div id="adminLoginModal">
  <div class="modal-content">
    <h3>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
    <input type="password" id="adminPasswordInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" autofocus />
    <button id="adminLoginBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <p id="loginError" class="error"></p>
  </div>
</div>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
<div class="edit-container" style="display:none;" id="editSection">
  <button id="backBtn" class="back-button">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
  
  <h2>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
  <table id="usersTable">
    <thead>
      <tr>
        <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
        <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
        <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
        <th>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</th>
        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
      </tr>
    </thead>
    <tbody>
      <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
    </tbody>
  </table>
</div>

<script>
  const adminPassword = "admin0408";

  const adminLoginModal = document.getElementById('adminLoginModal');
  const adminPasswordInput = document.getElementById('adminPasswordInput');
  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const loginError = document.getElementById('loginError');
  const editSection = document.getElementById('editSection');
  const usersTableBody = document.querySelector('#usersTable tbody');
  const backBtn = document.getElementById('backBtn');

  adminLoginBtn.addEventListener('click', () => {
    const pass = adminPasswordInput.value.trim();
    if(pass === adminPassword) {
      loginError.textContent = '';
      adminLoginModal.style.display = 'none';
      editSection.style.display = 'block';
      loadUsers();
    } else {
      loginError.textContent = '‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
    }
  });

  adminPasswordInput.addEventListener('keypress', e => {
    if(e.key === 'Enter') {
      adminLoginBtn.click();
    }
  });

  backBtn.addEventListener('click', () => {
    history.back();
  });

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å localStorage ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
  function loadUsers() {
    usersTableBody.innerHTML = '';
    let users = JSON.parse(localStorage.getItem('users')) || [];
    users.forEach((user, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" value="${user.name}" data-index="${index}" data-field="name" /></td>
        <td><input type="text" value="${user.studentId}" data-index="${index}" data-field="studentId" pattern="\\d{8}" title="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 8 ‡∏´‡∏•‡∏±‡∏Å" /></td>
        <td><input type="email" value="${user.email}" data-index="${index}" data-field="email" /></td>
        <td>
          <input type="password" value="${user.password}" data-index="${index}" data-field="password" id="pwd-${index}" />
          <button type="button" class="togglePwdBtn" data-index="${index}">üëÅÔ∏è</button>
        </td>
        <td><button data-index="${index}" class="saveBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></td>
      `;
      usersTableBody.appendChild(tr);
    });

    addTogglePasswordListeners();

    // ‡∏ú‡∏π‡∏Å event ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß
    document.querySelectorAll('.saveBtn').forEach(btn => {
      btn.addEventListener('click', e => {
        const idx = e.target.getAttribute('data-index');
        saveUser(idx);
      });
    });
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  function saveUser(index) {
    let users = JSON.parse(localStorage.getItem('users')) || [];

    // ‡∏´‡∏≤ input ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    const inputs = usersTableBody.querySelectorAll(`input[data-index="${index}"]`);
    let updatedUser = {};

    inputs.forEach(input => {
      updatedUser[input.dataset.field] = input.value.trim();
    });

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
    const studentIdPattern = /^\d{8}$/;
    if(!studentIdPattern.test(updatedUser.studentId)) {
      alert('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 8 ‡∏´‡∏•‡∏±‡∏Å');
      return;
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)
    for(let i=0; i<users.length; i++) {
      if(i != index && users[i].email === updatedUser.email) {
        alert('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
        return;
      }
    }

    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï user ‡πÉ‡∏ô array
    users[index] = updatedUser;
    localStorage.setItem('users', JSON.stringify(users));
    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    loadUsers();
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° event ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π/‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
  function addTogglePasswordListeners() {
    document.querySelectorAll('.togglePwdBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const index = btn.getAttribute('data-index');
        const pwdInput = document.getElementById(`pwd-${index}`);
        if (pwdInput.type === 'password') {
          pwdInput.type = 'text';
          btn.textContent = 'üôà';
        } else {
          pwdInput.type = 'password';
          btn.textContent = 'üëÅÔ∏è';
        }
      });
    });
  }
</script>

</body>
</html>
