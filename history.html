<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f4f8;
    margin: 0;
    padding: 20px;
  }
  .container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  }
  h2 {
    text-align: center;
    color: #333;
    margin-bottom: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: center;
  }
  th {
    background-color: #2196F3;
    color: white;
  }
  button {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  .btn-delete {
    background-color: #e53935;
    color: white;
  }
  .btn-delete:hover {
    background-color: #b71c1c;
  }
  .btn-print {
    background-color: #4CAF50;
    color: white;
  }
  .btn-print:hover {
    background-color: #388e3c;
  }
  .nav-link {
    display: block;
    margin-top: 20px;
    text-align: center;
    color: #2196F3;
    font-weight: bold;
    text-decoration: none;
  }
</style>
</head>
<body>
  <div class="container">
    <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</h2>
    <table id="historyTable">
      <thead>
        <tr>
          <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
          <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody>
        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
      </tbody>
    </table>
    <a href="index.html" class="nav-link">üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</a>
  </div>

<script>
  const historyTableBody = document.querySelector('#historyTable tbody');

  function loadHistory() {
    const history = JSON.parse(localStorage.getItem('withdrawHistory') || '[]');
    historyTableBody.innerHTML = '';

    if(history.length === 0) {
      historyTableBody.innerHTML = '<tr><td colspan="6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</td></tr>';
      return;
    }

    history.forEach((item, index) => {
      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${item.name}</td>
        <td>${item.student_id}</td>
        <td>${parseFloat(item.amount).toFixed(2)}</td>
        <td>${item.date}</td>
        <td>
          <button class="btn-print" onclick="printItem(${index})">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
          <button class="btn-delete" onclick="deleteItem(${index})">‚ùå ‡∏•‡∏ö</button>
        </td>
      `;

      historyTableBody.appendChild(tr);
    });
  }

  function printItem(index) {
    const history = JSON.parse(localStorage.getItem('withdrawHistory') || '[]');
    if(!history[index]) return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');

    localStorage.setItem('lastSubmit', JSON.stringify(history[index]));
    window.open('print-form.html', '_blank');
  }

  function deleteItem(index) {
    if(!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;

    let history = JSON.parse(localStorage.getItem('withdrawHistory') || '[]');
    history.splice(index, 1);
    localStorage.setItem('withdrawHistory', JSON.stringify(history));
    loadHistory();
  }

  // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤
  if(localStorage.getItem('isLoggedIn') !== 'true') {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
    window.location.href = 'login.html';
  } else {
    loadHistory();
  }
</script>
</body>
</html>
